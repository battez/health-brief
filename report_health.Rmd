---
title: "report_health"
author: "Luke Barker"
date: "23/04/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)    # includes readr & tibble
library(lubridate)    # for dates
library(stringr)      # useful string library

## adjust columns to be more manageable:
corrected_cols <- cols(
  Entity = col_character(),
  Code = col_character(),
  Year = col_integer()
)

# import two datasets
dbvhe  <- readr::read_csv("data/disease-burden-vs-health-expenditure-per-capita.csv", col_types=corrected_cols) 

ndbrf  <- readr::read_csv("data/number-of-deaths-by-risk-factor.csv", col_types=corrected_cols)

# remove cumbersome column names prefix, then the suffix
ndbrf <- ndbrf %>% 
  
  rename_with(stringr::str_replace, pattern='Deaths - Cause: All causes - Risk: ', replacement="") %>%
  rename_with(gsub, pattern=" - .*", replacement="")



```
```{r causes-death}
causes_totals <- ndbrf %>%
  # we are adding all years and treating it as globally (add all countries)
  #TODO: check NAs do not overly affect this?
  summarise(across(c(4:31) , sum)) %>%
  pivot_longer(c(1:28), values_to="total") %>%
  arrange(desc(total))

# TODO:make this a kable table
print(head(causes_totals, 3))

# demonstrate better via a column plot of all deaths 
## fix scales of big numbers
library(scales)
ggplot(data=causes_totals, aes(x = reorder(name, -total), y=total )) +
  geom_col() + 
  coord_flip() +
  expand_limits(x = c(0, NA), y = c(0,NA)) +
  scale_y_discrete(labels = scales::label_number_si()) +
  theme(axis.text.y = element_text(face="bold", color="#993333", 
                           size=10))
#TODO numbers seem obscured on x axis

```

```{r causes-trends}

```

```{r smoking-alcohol}

```

```{r expenditures}

```

```{r subjective}

```

```{r conclusions}

```





